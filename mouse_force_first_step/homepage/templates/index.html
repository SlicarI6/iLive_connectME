{% extends 'base.html' %}
{% load static %}

{% block title %}Homepage{% endblock %}

{% block header %}
<h1>Welcome to our Application</h1>
<nav>
    <a href="#">Home</a>
    <a href="#">About</a>
    <a href="#">Contact</a>
    {% if user.is_authenticated and user.role == 'simple' %}
        <span>You are logged in as {{ user.username }}</span>
        <form method="POST" action="{% url 'logout' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Logout</button>
        </form>
    {% else %}
        <a href="#" id="openRoleOverlay">Login</a>
    {% endif %}
</nav>
{% endblock %}

{% block content %}
<section class="intro">
    <h2>About Us</h2>
    <p>Welcome to our website! We offer a variety of services to help you achieve your goals.</p>
    <a href="#" class="btn">Learn More About Our Features.</a>
</section>
{% endblock %}

{% block footer %}
<p>&copy; 2024 - Your Company</p>
{% endblock %}

{% block extra_js %}

<!-- Select Role Overlay -->
<div id="roleOverlay" class="overlay" style="display: none;">
    <div class="overlay-content">
        <h2>Select your account type</h2>
        <form method="post" action="{% url 'select_role' %}">
            {% csrf_token %}
            <label><input type="radio" name="role" value="customer" required> Customer Account</label><br>
            <label><input type="radio" name="role" value="simple" required> Simple User</label><br><br>
            <button type="submit">Continue</button>
        </form>
    </div>
</div>

<!-- Cookie Banner (always in HTML) -->
<div id="cookieOverlay" style="display: none;"></div>

<div id="cookieConsent" style="display: none;">
    <p style="margin: 0;">
        We use cookies to ensure you get the best experience on our website.
        <a href="{% url 'privacy_policy' %}" style="color: #FFCC00;">Privacy Policy</a>
    </p>
    <button id="acceptCookies">Accept</button>
    <button id="rejectCookies">Reject</button>
</div>

<!-- JS pentru overlay È™i cookies -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    // === Overlay login ===
    const loginLink = document.getElementById('openRoleOverlay');
    const overlay = document.getElementById('roleOverlay');
    const overlayContent = document.querySelector('.overlay-content');

    if (loginLink && overlay) {
        loginLink.addEventListener('click', function (e) {
            e.preventDefault();
            overlay.style.display = 'flex';
        });

        overlay.addEventListener('click', function (e) {
            if (!overlayContent.contains(e.target)) {
                overlay.style.display = 'none';
            }
        });
    }

    // === Cookie Logic ===
    const cookieConsent = document.getElementById('cookieConsent');
    const cookieOverlay = document.getElementById('cookieOverlay');
    const acceptBtn = document.getElementById('acceptCookies');
    const rejectBtn = document.getElementById('rejectCookies');

    const consent = localStorage.getItem('cookieConsent');

    if (consent !== 'accepted' && consent !== 'rejected') {
        cookieConsent.style.display = 'block';
        cookieOverlay.style.display = 'block';
    }

    function getCSRFToken() {
        const name = 'csrftoken';
        const cookieValue = document.cookie.split('; ').find(row => row.startsWith(name + '='));
        return cookieValue ? cookieValue.split('=')[1] : '';
    }

    if (acceptBtn) {
        acceptBtn.addEventListener('click', () => {
            fetch("{% url 'accept_cookies' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({ accepted: true })
            });
            localStorage.setItem('cookieConsent', 'accepted');
            cookieConsent.style.display = 'none';
            cookieOverlay.style.display = 'none';
        });
    }

    if (rejectBtn) {
        rejectBtn.addEventListener('click', () => {
            fetch("{% url 'accept_cookies' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify({ accepted: false })
            });
            localStorage.setItem('cookieConsent', 'rejected');
            cookieConsent.style.display = 'none';
            cookieOverlay.style.display = 'none';
        });
    }
});
</script>

{% endblock %}
